<!DOCTYPE html>
<html>
<head>
    <style>
        @page { size: letter; margin: 1.5cm; }
        body { font-family: 'Helvetica', 'Arial', sans-serif; color: #333; line-height: 1.2; }
        .table-main { width: 100%; border: 1.5pt solid black; border-collapse: collapse; margin-bottom: 10px; }
        .cell-border { border: 1pt solid black; padding: 6px; }
        .header-title { font-weight: bold; text-align: center; font-size: 11pt; }
        .bg-header { background-color: #8B0000; color: white; text-align: center; font-weight: bold; padding: 4px; }
        .logo-box { font-size: 18pt; color: #8B0000; font-weight: bold; text-align: center; }
        .text-center { text-align: center; }
        .text-small { font-size: 9pt; }
        .data-row td { border: 0.5pt solid black; padding: 4px; font-size: 10pt; }
    </style>
</head>
<body>
    <table class="table-main">
        <tr>
            <td rowspan="3" class="cell-border logo-box" style="width: 25%;">BIBLIOTECA</td>
            <td colspan="2" class="cell-border header-title">SISTEMA DE GESTIÓN INTERNO</td>
        </tr>
        <tr>
            <td colspan="2" class="cell-border header-title" style="background-color: #f2f2f2;">{{ titulo_reporte }}</td>
        </tr>
        <tr>
            <td class="cell-border text-center">FECHA: {{ fecha }}</td>
            <td class="cell-border text-center">PÁGINA: 1 / 1</td>
        </tr>
    </table>

    <br>

    {% if tipo == 'prestamos' %}
    <table class="table-main">
        <tr><td colspan="4" class="bg-header">DETALLE DE LIBROS FUERA DE ESTANTE</td></tr>
        <tr style="background-color: #dddddd; font-weight: bold;">
            <td class="cell-border text-center" style="width: 10%;">No.</td>
            <td class="cell-border">TÍTULO DEL LIBRO</td>
            <td class="cell-border">USUARIO ASIGNADO</td>
            <td class="cell-border text-center">FECHA PRÉSTAMO</td>
        </tr>
        {% for p in items %}
        <tr class="data-row">
            <td class="text-center">{{ forloop.counter }}</td>
            <td>{{ p.libro.titulo }}</td>
            <td>{{ p.usuario.username }}</td>
            <td class="text-center">{{ p.fecha_prestamo }}</td>
        </tr>
        {% endfor %}
    </table>

    {% elif tipo == 'multas_general' %}
    <table class="table-main">
        <tr><td colspan="4" class="bg-header">CONTROL GENERAL DE MULTAS</td></tr>
        <tr style="background-color: #dddddd; font-weight: bold;">
            <td class="cell-border text-center" style="width: 10%;">ID</td>
            <td class="cell-border">USUARIO</td>
            <td class="cell-border">MONTO</td>
            <td class="cell-border text-center">ESTADO</td>
        </tr>
        {% for m in items %}
        <tr class="data-row">
            <td class="text-center">{{ m.id }}</td>
            <td>{{ m.usuario.username }}</td>
            <td>$ {{ m.monto }}</td>
            <td class="text-center">{% if m.pagada %}PAGADA{% else %}PENDIENTE{% endif %}</td>
        </tr>
        {% endfor %}
    </table>

    {% elif tipo == 'usuarios_detalle' %}
        {% for u in usuarios_list %}
        <table class="table-main">
            <tr><td colspan="3" class="bg-header">USUARIO: {{ u.username|upper }}</td></tr>
            <tr style="background-color: #f9f9f9; font-weight: bold;">
                <td class="cell-border" style="width: 30%;">FECHA</td>
                <td class="cell-border">CONCEPTO</td>
                <td class="cell-border" style="width: 20%;">VALOR</td>
            </tr>
            {% for multa in u.multa_set.all %}
            <tr class="data-row">
                <td>{{ multa.fecha }}</td>
                <td>Multa por {{ multa.tipo }} - Préstamo #{{ multa.prestamo.id }}</td>
                <td>$ {{ multa.monto }}</td>
            </tr>
            {% endfor %}
        </table>
        <br>
        {% endfor %}
    {% endif %}

    <div style="margin-top: 50px;">
        <table style="width: 100%;">
            <tr>
                <td style="text-align: center; border-top: 1pt solid black; width: 40%; padding-top: 5px;">Firma Bibliotecario Encargado</td>
                <td style="width: 20%;"></td>
                <td style="text-align: center; border-top: 1pt solid black; width: 40%; padding-top: 5px;">Sello Administrativo</td>
            </tr>
        </table>
    </div>
</body>
</html>